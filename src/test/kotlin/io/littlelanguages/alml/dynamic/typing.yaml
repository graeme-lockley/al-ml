- name: Identity
  input: |
    let identity x = x;
    let someValue = identity 10
  output:
    program:
      values:
        - someValue
      procedures:
        - procedure:
            name: identity
            parameters: [ x ]
            depth: 0
            offsets: 1
            es:
              - parameter:
                  name: x
                  depth: 0
                  offset: 0
        - procedure:
            name: _main
            parameters: [ ]
            depth: 0
            offsets: 0
            es:
              - assign:
                  symbol:
                    toplevel-value: someValue
                  es:
                    - call-procedure:
                        procedure:
                          declared-procedure:
                            name: identity
                            parameter-count: 1
                            depth: 0
                        es:
                          - - 10
                        line-number: 2
- name: signal expression
  input: |
    signal "DivideByZero"
  constraints:
    - String ~ String
- scenario:
    name: if
    tests:
      - name: with else
        input: |
          if (1) -> "hello" else "world"
        constraints:
          - S32 ~ Bool
          - String ~ String
      - name: without else
        input: |
          if (1) -> "hello"
        constraints:
          - S32 ~ Bool
- scenario:
    name: reference top-level value
    tests:
      - name: untyped
        input: |
          let name = "Hello";
          if name -> name
        constraints:
          - "'0 ~ String"
          - "'0 ~ Bool"
        environment:
          - "name='0"
      - name: typed
        input: |
          let name: String = "Hello";
          if name -> name
        constraints:
          - String ~ String
          - String ~ Bool
        environment:
          - name=String
- scenario:
    name: reference top-level procedure
    tests:
      - name: untyped
        input: |
          let identity a = a;
          let x = identity 1
        constraints:
          - "'1 -> '0 ~ S32 -> '3"
          - "'2 ~ '3"
        environment:
          - "identity='1 -> '0"
          - "x='2"
